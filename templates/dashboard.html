<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Visit Dashboard - yotesafari Tanzania Adventure</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* === CSS zako zilezile ulizoandika === */
  
<style>
    :root {
      --primary:#4361ee; 
      --secondary:#7209b7; 
      --accent:#4cc9f0;
      --success:#16a34a; 
      --warning:#f59e0b; 
      --danger:#ef4444;
      --dark:#1e293b; 
      --light:#f8fafc; 
      --gray:#64748b;
      --card-bg:rgba(255,255,255,0.96);
      --shadow:0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg:0 10px 25px rgba(0,0,0,0.15);
      --radius:16px; 
      --transition:all 0.3s ease;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Inter',sans-serif;
      background:linear-gradient(135deg,#f0f4f8 0%,#e2e8f0 100%);
      color:var(--dark);
      line-height:1.6;
      padding:10px;
      min-height:100vh;
    }
    .dashboard-container{max-width:1400px;margin:0 auto;padding:0 10px}

    /* ===== HEADER ===== */
    .dashboard-header{
      text-align:center;
      margin-bottom:20px;
      padding:15px;
      background:var(--card-bg);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .dashboard-header h1{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-size:1.8rem;
      font-weight:800;
      text-transform:uppercase;
    }
    .dashboard-header h1 span{
      padding:5px 12px;
      border-radius:10px;
      color:white;
      font-weight:800;
      box-shadow:0 4px 8px rgba(0,0,0,0.2);
    }
    .dashboard-header h1 span:nth-child(2){background:linear-gradient(135deg,#ff5733,#ff8c33);}
    .dashboard-header h1 span:nth-child(3){background:linear-gradient(135deg,#33c633,#00ff99);}
    .dashboard-header h1 span:nth-child(4){background:linear-gradient(135deg,#3399ff,#33ccff);}
    .dashboard-header p{font-size:0.95rem;color:var(--gray);margin-top:6px}

    /* ===== STAT CARDS ===== */
    .stats-cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:15px;
      margin-bottom:20px;
    }
    .stat-card{
      border-radius:var(--radius);
      padding:20px 15px;
      box-shadow:var(--shadow);
      text-align:center;
      transition:var(--transition);
      color:white;
      font-weight:600;
    }
    .stat-card:nth-child(1){background:linear-gradient(135deg,#ff4d4d,#ff6a00);}
    .stat-card:nth-child(2){background:linear-gradient(135deg,#0099ff,#00ccff);}
    .stat-card:nth-child(3){background:linear-gradient(135deg,#33cc33,#00e676);}
    .stat-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
    .stat-card i{font-size:1.8rem;margin-bottom:10px;}
    .stat-card h3{font-size:1.7rem;margin-bottom:5px;font-weight:800;}
    .stat-card p{font-size:1rem;}

    /* ===== CHARTS ===== */
    .charts-container{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      margin-bottom:20px;
    }
    .chart-card{
      background:var(--card-bg);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
      transition:var(--transition);
    }
    .chart-card h2{
      margin-bottom:15px;
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--dark);
      font-weight:700;
      font-size:1.1rem;
    }
    .chart-wrapper{
      width:100%;
      min-height:250px;
      overflow-x:auto; /* Hii inaruhusu scrolling kwenye mobile */
    }
    canvas{ /* Hii itafanya chart resize auto */
      width:100% !important;
      height:auto !important;
    }

    /* ===== TABLE ===== */
    .visits-table-container{
      background:var(--card-bg);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
      margin-bottom:20px;
      overflow-x:auto;
    }
    .visits-table-container h2{
      margin-bottom:15px;
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--dark);
      font-weight:700;
      font-size:1.1rem;
    }
    table{width:100%;border-collapse:collapse;min-width:500px}
    th{background:var(--primary);color:white;padding:10px;text-align:left;font-weight:600;font-size:0.85rem;}
    td{padding:8px;border-bottom:1px solid rgba(0,0,0,0.05);font-size:0.8rem;}
    tr:hover td{background-color:rgba(67,97,238,0.05)}
    .ip-highlight{
      font-family:'Courier New',monospace;
      background:rgba(67,97,238,0.1);
      padding:2px 6px;
      border-radius:6px;
    }
    .timestamp{font-size:0.75rem;color:var(--gray)}
    .page-url{
      font-size:0.8rem;
      color:var(--primary);
      white-space:nowrap;
      overflow-x:auto;
      display:block;
      max-width:150px;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px){
      .charts-container{grid-template-columns:1fr;}
    }
    @media (max-width: 768px){
      .dashboard-header h1{font-size:1.5rem;}
      .stat-card h3{font-size:1.5rem;}
      .stat-card p{font-size:0.95rem;}
      .chart-wrapper{min-height:200px;}
    }
    @media (max-width: 480px){
      body{padding:8px;}
      .dashboard-header h1{font-size:1.3rem;}
      .stat-card h3{font-size:1.3rem;}
      .stat-card i{font-size:1.4rem;}
      .chart-wrapper{min-height:180px;}
      table{min-width:0;font-size:0.75rem;}
      th,td{padding:6px;}
      .page-url{max-width:120px;}
    }
  </style>
  </style>
</head>
<body>
<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 style="color: black;">
      <i class="fas fa-chart-line"></i>     
      <span>User</span>
      <span>Visit</span>
      <span>Dashboard</span>
    </h1>
    <p>Yote Safari Tanzania Adventure - Advanced Analytics & Real-time Visitor Tracking</p>
  </div>

  <!-- Stats -->
  <div class="stats-cards">
    <div class="stat-card"><i class="fas fa-users"></i><h3>{{ total_visits }}</h3><p>Total Visits</p></div>
    <div class="stat-card"><i class="fas fa-map-marked-alt"></i><h3>{{ visits_by_country|length }}</h3><p>Countries</p></div>
    <div class="stat-card"><i class="fas fa-sync-alt"></i><h3>{{ avg_visits_per_ip }}</h3><p>Avg Visits/IP</p></div>
  </div>

  <!-- Charts -->
  <div class="charts-container">
    <div class="chart-card">
      <h2><i class="fas fa-chart-bar"></i> Visits by Country</h2>
      <div class="chart-wrapper">
        <canvas id="countryChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h2><i class="fas fa-chart-pie"></i> Visit Distribution</h2>
      <div class="chart-wrapper">
        <canvas id="visitDistributionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="visits-table-container">
    <h2><i class="fas fa-table"></i> Recent Visits</h2>
    <div class="table-responsive">
      <table id="visitsTable">
        <thead style="color: black;">
          <tr><th style="color: black;">IP</th><th style="color: black;">Location</th><th style="color: black;">Count</th><th style="color: black;">Timestamp</th><th style="color: black;">Page Visited</th></tr>
        </thead>
        <tbody>
          {% for item in visits %}
          <tr>
            <td><span class="ip-highlight">{{ item.ip_address }}</span></td>
            <td>{% if item.country %}<strong>{{ item.country }}, {{ item.city }}</strong>{% else %}<em>Unknown</em>{% endif %}</td>
            <td>{{ item.visit_count }}</td>
            <td><div class="timestamp">{{ item.timestamp|date:"M d, Y H:i" }}</div></td>
            <td><div class="page-url">{{ item.page_visited }}</div></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const countryData = [
    {% for item in visits_by_country %}
      {country:"{{ item.country|escapejs }}",count:{{ item.count }}},
    {% endfor %}
  ];

  const ctxCountry = document.getElementById('countryChart').getContext('2d');

  new Chart(ctxCountry,{
    type:'bar',
    data:{
      labels: countryData.map(c => c.country || 'Unknown'),
      datasets:[{
        label:'Visits',
        data: countryData.map(c => c.count),
        backgroundColor:'rgba(67,97,238,0.7)'
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{
          ticks:{autoSkip:false, maxRotation:90, minRotation:45},
          grid:{display:false}
        },
        y:{beginAtZero:true,grid:{color:'rgba(0,0,0,0.05)'}}
      }
    }
  });

  const visitDistributionData = {
    labels:['New','Returning','Local'],
    datasets:[{
      data:[65,25,10],
      backgroundColor:['rgba(67,97,238,0.7)','rgba(114,9,183,0.7)','rgba(76,201,240,0.7)'],
      borderColor:['rgba(67,97,238,1)','rgba(114,9,183,1)','rgba(76,201,240,1)'],
      borderWidth:1
    }]
  };

  new Chart(document.getElementById('visitDistributionChart'),{
    type:'doughnut',
    data:visitDistributionData,
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{position:'bottom'}}
    }
  });
</script>


<script>
  // ===== Visits by Country =====
  const countryData = [
    {% for item in visits_by_country %}
      {country:"{{ item.country|default:'Unknown'|escapejs }}", count:{{ item.count }}},
    {% endfor %}
  ];

  const ctxCountry = document.getElementById('countryChart').getContext('2d');
  new Chart(ctxCountry,{
    type:'bar',
    data:{
      labels: countryData.map(c => c.country),
      datasets:[{
        label:'Visits',
        data: countryData.map(c => c.count),
        backgroundColor:'rgba(67,97,238,0.7)'
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{ticks:{autoSkip:false, maxRotation:90, minRotation:45}, grid:{display:false}},
        y:{beginAtZero:true, grid:{color:'rgba(0,0,0,0.05)'}}
      }
    }
  });

  // ===== Visit Distribution =====
  const visitDistributionData = {
    labels:['New','Returning','Local'],
    datasets:[{
      data:[{{ new_visits }}, {{ returning_visits }}, {{ local_visits }}],
      backgroundColor:[
        'rgba(67,97,238,0.7)',
        'rgba(114,9,183,0.7)',
        'rgba(76,201,240,0.7)'
      ],
      borderColor:[
        'rgba(67,97,238,1)',
        'rgba(114,9,183,1)',
        'rgba(76,201,240,1)'
      ],
      borderWidth:1
    }]
  };

  new Chart(document.getElementById('visitDistributionChart'),{
    type:'doughnut',
    data:visitDistributionData,
    options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}}}
  });
</script>

</body>
</html>
